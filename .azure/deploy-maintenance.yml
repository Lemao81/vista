trigger: none

pool:
  name: 'MyLocalAgentPool'

variables:
  dotNetVersion: '9.0.200'
  project: 'backend/src/Services/Maintenance/WebApi/WebApi.csproj'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'
  webApp: 'app-vista-maintenance-dev-001'
  subscription: 'MyAzureSubscription(19a97b41-e18f-481b-a072-dba7985b27bd)'

steps:
  - checkout: self
    displayName: 'Checkout'
    clean: true
    fetchDepth: 1

  - task: NuGetToolInstaller@1

  - task: UseDotNet@2
    displayName: 'Use .NET $(dotNetVersion)'
    inputs:
      version: $(dotNetVersion)

  - task: DotNetCoreCLI@2
    displayName: 'Publish Maintenance'
    inputs:
      command: 'publish'
      feedsToUse: 'select'
      verbosityRestore: 'Normal'
      publishWebProjects: false
      projects: '$(project)'
      modifyOutputPath: false
      configuration: '$(buildConfiguration)'

  - task: AzureWebApp@1
    displayName: 'Web App Deployment'
    inputs:
      azureSubscription: '$(subscription)'
      appType: 'webAppLinux'
      appName: '$(webApp)'
      package: '$(Build.SourcesDirectory)/**/Maintenance/**/publish.zip'